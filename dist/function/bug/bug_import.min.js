(()=>{function e(e){return e&&""!==e.trim()?"open"===e.toLowerCase()?"Open":"reopened"===e.toLowerCase()?"Reopened":"in progress"===e.toLowerCase()?"In Progress":"resolved"===e.toLowerCase()?"Resolved":"closed"===e.toLowerCase()?"Closed":"cancelled"===e.toLowerCase()?"Cancelled":"Open":"Open"}function t(e,t,c){let u=function(e,t,c){const u=c.common.project_id,d=c.common.bug_product_id,a=c.bug.qc_activity,r=c.bug.priority,l=c.bug.defect_origin,_=c.bug.severity,f=c.bug.role,m=c.bug.defect_type,g=c.bug.cause_category,p=c.bug.qc_activity_default,y=c.bug.priority_default,h=c.bug.defect_origin_default,$=c.bug.severity_default,b=c.bug.role_default,w=c.bug.defect_type_default,T=c.bug.cause_category_default;let R=$||o(_,e.severity),k=b||o(f,e.role),v=w||o(m,e.defect_type),O=T||o(g,e.cause_category),j=h||o(l,e.defect_origin),x=y||o(r,e.priority),I=p||o(a,e.qc_activity),M=s(e.description),C="";return C+=`pid=${u}`,C+="&formToken=",C+="&issuetype=1",C+=`&atl_token=${n(t)}`,C+=`&summary=${n(M)}`,C+=`&customfield_12610=${d}`,C+=`&description=${n(e.description)}`,C+="&customfield_10600=",C+=`&customfield_11401=${n(j)}`,C+=`&priority=${n(x,4)}`,C+=`&customfield_10303=${n(R,"-1")}`,C+=`&customfield_10302=${n(I)}`,C+=`&customfield_10601=${n(e.cause_analysis)}`,C+="&customfield_10602=",C+=`&customfield_10603=${n(e.corrective_action)}`,C+="&customfield_10604=",C+="&customfield_12644=-1",C+="&environment=",C+=`&assignee=${n(e.assigner)}`,C+=`&customfield_11405=${n(k,"-1")}`,C+=`&reporter=${n(e.reporter)}`,C+=`&customfield_10203=${i(e.plan_start_date,"DD/MMM/YY LT")}`,C+=`&timetracking_originalestimate=${n(e.original_estimate)}`,C+=`&timetracking_remainingestimate=${n(e.remaining_estimate)}`,C+="&isCreateIssue=true",C+="&hasWorkStarted=",C+="&customfield_13100=",C+="&customfield_13101=-1",C+="&customfield_13102=",C+="&customfield_13205=",C+=`&duedate=${i(e.due_date,"DD/MMM/YY")}`,C+="&dnd-dropzone=",C+="&customfield_10000=",C+="&customfield_11403=",C+="&customfield_11406=",C+="&issuelinks=issuelinks",C+="&issuelinks-linktype=blocks",C+="&customfield_12901=",C+="&security=11100",C+=`&customfield_10301=${n(v,"-1")}`,C+=`&customfield_10300=${n(O,"-1")}`,C+="&customfield_18403=-1",C+="&customfield_10202=",C+="&customfield_10200=",C+="&customfield_10201=",C+="&fieldsToRetain=project",C+="&fieldsToRetain=issuetype",C+="&fieldsToRetain=components",C+="&fieldsToRetain=customfield_12610",C+="&fieldsToRetain=customfield_10600",C+="&fieldsToRetain=fixVersions",C+="&fieldsToRetain=customfield_11401",C+="&fieldsToRetain=priority",C+="&fieldsToRetain=customfield_10303",C+="&fieldsToRetain=customfield_10302",C+="&fieldsToRetain=versions",C+="&fieldsToRetain=customfield_10601",C+="&fieldsToRetain=customfield_10602",C+="&fieldsToRetain=customfield_10603",C+="&fieldsToRetain=customfield_10604",C+="&fieldsToRetain=customfield_12644",C+="&fieldsToRetain=environment",C+="&fieldsToRetain=assignee",C+="&fieldsToRetain=customfield_11405",C+="&fieldsToRetain=reporter",C+="&fieldsToRetain=customfield_10203",C+="&fieldsToRetain=customfield_13100",C+="&fieldsToRetain=customfield_13101",C+="&fieldsToRetain=customfield_13102",C+="&fieldsToRetain=customfield_13205",C+="&fieldsToRetain=duedate",C+="&fieldsToRetain=labels",C+="&fieldsToRetain=customfield_10000",C+="&fieldsToRetain=customfield_11403",C+="&fieldsToRetain=customfield_11406",C+="&fieldsToRetain=customfield_11829",C+="&fieldsToRetain=issuelinks",C+="&fieldsToRetain=customfield_10001",C+="&fieldsToRetain=customfield_12901",C+="&fieldsToRetain=security",C+="&fieldsToRetain=customfield_10301",C+="&fieldsToRetain=customfield_10300",C+="&fieldsToRetain=customfield_18403",C+="&fieldsToRetain=customfield_10202",C+="&fieldsToRetain=customfield_10200",C+="&fieldsToRetain=customfield_10201",C+="&fieldsToRetain=customfield_18304",C}(c,t,e);return fetch(e.common.jira_base_url+"/secure/QuickCreateIssue.jspa?decorator=none",{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:u,method:"POST"})}function i(e,t){let i=new Date;return e&&""!==e.trim()&&(i=new Date(e)),moment(i).format(t)}function s(e){return e.length<=10?e.replace(/(?:\r\n|\r|\n)/g," - "):e.trim().split(/\r?\n/)[0]}function o(e,t,i){return t?Object.keys(e).find((i=>e[i]===t)):""}function c(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}function n(e,t){return e&&""!==e.trim()?encodeURIComponent(e):t||""}function u(e,t,i){fetch(`${e.common.jira_base_url}/secure/WorkflowUIDispatcher.jspa?id=${i}&action=4&atl_token=${t}&decorator=dialog&inline=true&_=1650185614805`,{headers:{accept:"*/*"},body:null,method:"GET"})}function d(e,t,i){return fetch(`${e.common.jira_base_url}/secure/WorkflowUIDispatcher.jspa?id=${i}&action=751&atl_token=${t}&decorator=dialog&inline=true&_=1650126105103`,{headers:{accept:"*/*"},body:null,method:"GET"})}function a(e,t,i,s){const c=e.bug.qc_activity,u=e.bug.defect_origin,d=e.bug.severity,a=e.bug.defect_type,r=e.bug.cause_category,l=e.bug.qc_activity_default,_=e.bug.defect_origin_default,f=e.bug.severity_default,m=e.bug.defect_type_default,g=e.bug.cause_category_default;let p=f||o(d,s.severity),y=m||o(a,s.defect_type),h=g||o(r,s.cause_category),$=_||o(u,s.defect_origin),b=l||o(c,s.qc_activity),w="";return w+="inline=true",w+="&decorator=dialog",w+="&action=731",w+=`&id=${i}`,w+="&viewIssueKey=",w+="&resolution=1",w+=`&customfield_10303=${n(p,"-1")}`,w+=`&customfield_10302=${n(b)}`,w+="&customfield_18403=-1",w+=`&customfield_10301=${n(y,"-1")}`,w+=`&customfield_11401=${n($)}`,w+=`&customfield_10300=${n(h,"-1")}`,w+=`&customfield_10601=${n(s.cause_analysis)}`,w+="&customfield_12644=-1",w+=`&customfield_10603=${n(s.corrective_action)}`,w+="&customfield_10602=",w+="&customfield_10604=",w+=`&description=${n(s.description)}`,w+="&customfield_10600=",w+=`&assignee=${n(s.assigner)}`,w+="&dnd-dropzone=",w+="&customfield_11406=",w+="&customfield_13100=",w+="&customfield_13101=-1",w+="&customfield_13102=",w+="&customfield_13205=",w+="&customfield_12901=",w+="&comment=",w+="&commentLevel=",w+=`&atl_token=${t}`,fetch(`${e.common.jira_base_url}/secure/CommentAssignIssue.jspa?atl_token=${t}`,{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:w,method:"POST"})}function r(e,t,s,c){const u=e.bug.priority,d=e.bug.defect_origin,a=e.bug.cause_category,r=e.bug.priority_default,l=e.bug.defect_origin_default;let _=e.bug.cause_category_default||o(a,c.cause_category),f=l||o(d,c.defect_origin),m=r||o(u,c.priority),g="";return g+="inline=true",g+="&decorator=dialog",g+="&action=741",g+=`&id=${s}`,g+="&viewIssueKey=",g+="&resolution=6",g+=`&description=${n(c.description)}`,g+="&customfield_10600=",g+=`&customfield_10300=${n(_,"-1")}`,g+="&customfield_12644=-1",g+="&customfield_11938=",g+=`&assignee=${n(c.assigner)}`,g+=`&reporter=${n(c.reporter)}`,g+=`&priority=${n(m,4)}`,g+=`&customfield_11401=${n(f)}`,g+="&customfield_13100=",g+="&customfield_13101=-1",g+="&customfield_13102=",g+="&customfield_13205=",g+=`&duedate=${i(c.due_date,"DD/MMM/YY")}`,g+="&customfield_12901=",g+="&comment=",g+="&commentLevel=",g+=`&atl_token=${t}`,fetch(`${e.common.jira_base_url}/secure/CommentAssignIssue.jspa?atl_token=${t}`,{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:g,method:"POST"})}function l(e,t,i,s){const c=e.bug.qc_activity,u=e.bug.defect_origin,d=e.bug.severity,a=e.bug.defect_type,r=e.bug.cause_category,l=e.bug.qc_activity_default,_=e.bug.defect_origin_default,f=e.bug.severity_default,m=e.bug.defect_type_default,g=e.bug.cause_category_default;let p=f||o(d,s.severity),y=m||o(a,s.defect_type),h=g||o(r,s.cause_category),$=_||o(u,s.defect_origin),b=l||o(c,s.qc_activity),w="";return w+="inline=true",w+="&decorator=dialog",w+="&action=761",w+=`&id=${i}`,w+="&viewIssueKey=",w+="&resolution=2",w+=`&customfield_10303=${n(p,"-1")}`,w+=`&customfield_10302=${n(b)}`,w+="&customfield_18403=-1",w+=`&customfield_10301=${n(y,"-1")}`,w+=`&customfield_11401=${n($)}`,w+=`&customfield_10300=${n(h,"-1")}`,w+=`&customfield_10601=${n(s.cause_analysis)}`,w+="&customfield_12644=-1",w+=`&customfield_10603=${n(s.corrective_action)}`,w+="&customfield_10602=",w+="&customfield_10604=",w+=`&description=${n(s.description)}`,w+="&customfield_10600=",w+=`&assignee=${n(s.assigner)}`,w+="&dnd-dropzone=",w+="&customfield_11406=",w+="&customfield_13100=",w+="&customfield_13101=-1",w+="&customfield_13102=",w+="&customfield_13205=",w+="&customfield_12901=",w+="&comment=",w+="&commentLevel=",w+=`&atl_token=${t}`,fetch(`${e.common.jira_base_url}/secure/CommentAssignIssue.jspa?atl_token=${t}`,{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:w,method:"POST"})}function _(e,t,c,u){const d=e.common.bug_product_id,a=e.bug.qc_activity,r=e.bug.priority,l=e.bug.defect_origin,_=e.bug.severity,f=e.bug.role,m=e.bug.defect_type,g=e.bug.cause_category,p=e.bug.qc_activity_default,y=e.bug.priority_default,h=e.bug.defect_origin_default,$=e.bug.severity_default,b=e.bug.role_default,w=e.bug.defect_type_default,T=e.bug.cause_category_default;let R=$||o(_,u.severity),k=b||o(f,u.role),v=w||o(m,u.defect_type),O=T||o(g,u.cause_category),j=h||o(l,u.defect_origin),x=y||o(r,u.priority),I=p||o(a,u.qc_activity),M="";return M+="id=8128116",M+=`&atl_token=${t}`,M+="&formToken=99a046347bb4107fee8996d16a212c788b78c85c",M+="&issuetype=1",M+=`&summary=${n(s(u.description))}`,M+=`&customfield_12610=${d}`,M+=`&description=${n(u.description)}`,M+="&customfield_10600=",M+=`&customfield_11401=${n(j)}`,M+=`&priority=${n(x,4)}`,M+=`&customfield_10303=${n(R,"-1")}`,M+=`&customfield_10302=${n(I)}`,M+=`&customfield_10601=${n(u.cause_analysis)}`,M+="&customfield_10602=",M+=`&customfield_10603=${n(u.corrective_action)}`,M+="&customfield_10604=",M+="&customfield_12644=-1",M+="&environment=",M+=`&assignee=${n(u.assigner)}`,M+=`&customfield_11405=${n(k,"-1")}`,M+=`&reporter=${n(u.reporter)}`,M+=`&customfield_10203=${i(u.plan_start_date,"DD/MMM/YY LT")}`,M+=`&timetracking_originalestimate=${n(u.original_estimate)}`,M+=`&timetracking_remainingestimate=${n(u.remaining_estimate)}`,M+="&isCreateIssue=",M+="&hasWorkStarted=",M+="&customfield_13100=",M+="&customfield_13101=-1",M+="&customfield_13102=",M+="&customfield_13205=",M+=`&duedate=${i(u.due_date,"DD/MMM/YY")}`,M+="&dnd-dropzone=",M+="&customfield_10000=",M+="&customfield_11403=",M+="&customfield_11406=",M+="&issuelinks=issuelinks",M+="&issuelinks-linktype=blocks",M+="&customfield_12901=",M+="&security=11100",M+=`&customfield_10301=${n(v,"-1")}`,M+=`&customfield_10300=${n(O,"-1")}`,M+="&customfield_18403=-1",M+="&customfield_10202=",M+="&customfield_10200=",M+="&customfield_10201=",M+="&comment=",M+="&commentLevel=",fetch(`${e.common.jira_base_url}/secure/QuickEditIssue.jspa?issueId=${c}&decorator=none`,{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:M,method:"POST"})}!async function(){let i=await async function(){let e=await new Promise(((e,t)=>chrome.storage.local.get("settings",(function(t){e(t)})))),t=null;return e&&e.hasOwnProperty("settings")&&(t=e.settings),t}();if(!i)return;let s=window.location.href,o=i.common.jira_base_url;if(!s.includes(o))return;let n=await async function(){let e=await new Promise(((e,t)=>chrome.storage.local.get("import_status",(function(t){e(t)})))),t=null;return e&&e.hasOwnProperty("import_status")&&(t=e.import_status),t}();if("ready"===(n&&n.status?n.status:"wait")){if(chrome.storage.local.set({import_status:{status:"ready",is_first_time:!1}},(function(){console.log("Value is set to ","ready","is_first_time",!1)})),n.is_first_time){let e=i.common.account.username,t=i.common.account.password;return await fetch(`${o}/login.jsp?os_username=${e}&os_password=${t}`,{method:"POST"}),void(window.location.href=o)}document.getElementById("header-details-user-fullname")?async function(i){!function(){let e="";e+='<div style="position: fixed; bottom: 0; top: 0; right: 0; left: 0; z-index: 999; display: flex; justify-content: center; align-items: center; height: 99%; border: 3px solid green; background: #ddd; opacity: 0.5">',e+='   <img width="50%" src="https://raw.githubusercontent.com/cuongphuong/jira_worklog/master/img/loadding.gif"/>',e+="</div>",e+='<div style="position: fixed; bottom: 0; top: 0; right: 0; left: 0; z-index: 999; display: flex; justify-content: center; align-items: center; height: 100%;">',e+='    <p id="progress_id" style="color: red; font-size: 18em; padding:0; margin: 0; text-align: center">0/0</p>',e+="</div>",document.getElementById("page").innerHTML+='<div style="position: fixed; bottom: 0; top: 0; right: 0; left: 0; z-index: 999; display: flex; justify-content: center; align-items: center; height: 99%; border: 3px solid green; background: #ddd; opacity: 0.5">   <img width="50%" src="https://raw.githubusercontent.com/cuongphuong/jira_worklog/master/img/loadding.gif"/></div><div style="position: fixed; bottom: 0; top: 0; right: 0; left: 0; z-index: 999; display: flex; justify-content: center; align-items: center; height: 100%;">    <p id="progress_id" style="color: red; font-size: 18em; padding:0; margin: 0; text-align: center">0/0</p></div>'}();let s=(await async function(){let e=await new Promise(((e,t)=>chrome.storage.local.get("bug_data",(function(t){e(t)})))),t=null;return e&&e.hasOwnProperty("bug_data")&&(t=e.bug_data),t}()).dataList,o="";for(let n=0;n<s.length;n++){let f=s[n];if(f.temp_checked_status.rsl_status.includes("ERROR")||f.temp_checked_status.rsl_status.includes("IGNORE")){f.temp_imported_status="IGNORE",o+=`"${f.temp_result_issue_key}"\t"${f.temp_checked_status.rsl_msg.join(", ")}"\n`,document.getElementById("progress_id").innerHTML=`${n+1}/${s.length}`;continue}let m=c("atlassian.xsrf.token"),g=f.temp_id,p=[];if(f.temp_checked_status.rsl_status.includes("NEW")){let e=await t(i,m,f).then((e=>e.json()));200===e.status&&e.hasOwnProperty("createdIssueDetails")?(g=e.createdIssueDetails.id,f.temp_result_issue_key=e.createdIssueDetails.key):p.push(JSON.stringify(e))}if(f.temp_checked_status.rsl_status.includes("UPDATE_BASE_DATA")){let e=await _(i,m,g,f).then((e=>200!==e.status?e.json():{status:200}));(e.hasOwnProperty("errorMessages")||e.hasOwnProperty("errors"))&&p.push(JSON.stringify(e))}f.temp_checked_status.rsl_status.includes("CHANGE_STATUS")&&("Open"!==e(f.temp_issue_status)&&"Reopened"!==e(f.temp_issue_status)||await d(i,m,g),"In Progress"===e(f.temp_issue_status)&&await u(i,m,g),"Resolved"===e(f.temp_issue_status)&&(await d(i,m,g),(await a(i,m,g,f).then((e=>e.text()))).includes("<form action=")&&p.push("Resolve failed")),"Closed"===e(f.temp_issue_status)&&(await d(i,m,g),(await a(i,m,g,f).then((e=>e.text()))).includes("<form action=")&&p.push("Resolve failed"),(await r(i,m,g,f).then((e=>e.text()))).includes("<form action=")&&p.push("Close failed")),"Cancelled"===e(f.temp_issue_status)&&(await d(i,m,g),(await l(i,m,g,f).then((e=>e.text()))).includes("<form action=")&&p.push("Cancel failed"))),p.length>0?(f.temp_imported_status="ERROR",f.temp_checked_status.rsl_status=["ERROR"],f.temp_checked_status.rsl_msg=p,o+=`"${f.temp_result_issue_key}"\t"${JSON.stringify(p)}"\n`):(f.temp_imported_status="OK",f.temp_checked_status.rsl_status=["OK"],f.temp_checked_status.rsl_msg=["OK"],o+=`"${f.temp_result_issue_key}"\t"OK"\n`),document.getElementById("progress_id").innerHTML=`${n+1}/${s.length}`}console.log(o),chrome.storage.local.set({import_status:{status:"done",is_first_time:!1,result:o}},(function(){console.log("Value is set to ","done","is_first_time",!1),chrome.runtime.sendMessage({req:"close_this_tab"},(function(e){console.log(e)})),chrome.tabs.create({active:!0,url:"bug/bug_list.html"},null)}))}(i):chrome.runtime.sendMessage({req:"incorrect_user"},(function(e){console.log(e)}))}}()})();