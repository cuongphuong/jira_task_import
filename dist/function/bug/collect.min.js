(()=>{function e(e,t){let n={};for(const o in t){const a=t[o];if(null!==a&&!o.startsWith("__"))if(o.toLowerCase().includes("date")){let t=moment(new Date(e[a])).format("YYYY/MM/DD");new Date(t)<=new Date("2012/01/01")?n[o]=null:n[o]=t}else n[o]=e[a]}return n}function t(e){return new Promise((t=>setTimeout(t,e)))}function n(e){chrome.runtime.sendMessage({req:"collect_prgress_info",data:e},(function(e){console.log(e)}))}async function o(e,o){let a={title:document.querySelector("input.docs-title-input").value,sheetName:o};chrome.storage.local.set({bug_data:{dataList:e,config:a}},(function(){n("Data has been saved")})),await t(500)}window.location.href.includes("docs.google.com/spreadsheets/d/")&&(chrome.storage.local.set({import_status:{status:"collect"}},(function(){console.log("Value is set to ","ready")})),async function(){chrome.storage.local.set({bug_data:null},(function(){console.log("Data has been removed.")}));let a=window.location.href,s=/\/([\w-_]{15,})\/(.*?gid=(\d+))?/.exec(a);if(!s)return void o([],"n/a");n("start");let c=s[1],l=await async function(e,t,n="image/jpeg"){const o=await fetch(e),a=await o.blob();return new File([a],t,{type:a.type||n})}(`https://docs.google.com/spreadsheets/d/${c}/export?format=xlsx&id=${c}`,"c.xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8");for(;!document.querySelector(".docs-sheet-active-tab .docs-sheet-tab-name");)n("Wait for current sheet is loaded"),await t(1e3);let i=document.querySelector(".docs-sheet-active-tab .docs-sheet-tab-name").innerText;n(`Current sheet\n ${i}`);let r=await async function(t,o){let a=await async function(){let e=await new Promise(((e,t)=>chrome.storage.local.get("settings",(function(t){e(t)})))),t=null;return e&&e.hasOwnProperty("settings")&&(t=e.settings),t}(),s=a.bug.temp_col_index,c=await readXlsxFile(t,{sheet:o.replaceAll("/","")});const l=a.bug.temp_col_index.__start_row_index;let i=[];n("Reading file");for(let t=l;t<c.length;t++){if(null==c[t][2])continue;let n=e(c[t],s);i.push(n)}return n("Collect succes"),i}(l,i);n("Validating"),chrome.runtime.sendMessage({req:"process_data",data:r},(function(e){o(e.payload,i)}))}())})();