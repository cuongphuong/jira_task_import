(()=>{let e=!1;async function t(){if(e){try{document.getElementById("well_come_id").style.display="none"}catch(e){}i("img/wait.gif"),chrome.runtime.sendMessage({req:"load"},(function(e){console.log(e)})),await n()}}async function n(){for(;!await c();)console.log("Wait for collect data."),await l(1e3);i(null);let e=await c(),t=e.config,n="";n+=`<h3>${t.title}</h3>`,n+=`<p>(${t.sheetName})</p>`,document.getElementById("head_config").innerHTML=n,document.getElementById("total_record").innerText=e.dataList.length;let s=e.dataList,a=s.filter((e=>e.temp_checked_status.rsl_status.includes("NEW"))).length;document.getElementById("record_create").innerText=a;let o=s.filter((e=>e.temp_checked_status.rsl_status.includes("ERROR"))).length;document.getElementById("record_err").innerText=o;let d=s.filter((e=>e.temp_checked_status.rsl_status.includes("UPDATE_BASE_DATA")||e.temp_checked_status.rsl_status.includes("CHANGE_STATUS")&&!e.temp_checked_status.rsl_status.includes("NEW")&&!e.temp_checked_status.rsl_status.includes("ERROR"))).length;document.getElementById("record_update").innerText=d}function l(e){return new Promise((t=>setTimeout(t,e)))}async function c(){let e=await new Promise(((e,t)=>chrome.storage.local.get("bug_data",(function(t){e(t)})))),t=null;return e&&e.hasOwnProperty("bug_data")&&(t=e.bug_data),t}function i(e){let t=document.getElementById("wait_id"),n=document.getElementById("collect_progress"),l=document.getElementById("head_config"),c=document.getElementById("collect_info");if(t.style.display="inline-block",n.style.display="inline-block",l.style.display="none",c.style.display="none",!e)return t.style.display="none",n.style.display="none",l.style.display="inline-block",void(c.style.display="inline-block");t.src=chrome.runtime.getURL(e)}document.addEventListener("DOMContentLoaded",(async function(){let t=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(t[0].id,{req:"check_site"},(async function(t){t?(e=!0,i("img/load.png"),await n()):i("img/no_sp.png")})),chrome.runtime.onMessage.addListener((function(e,t,n){"collect_prgress_info"===e.req&&(document.getElementById("process_info").innerText=e.data,n())}))})),document.getElementById("wait_id").addEventListener("click",(function(){t()})),document.getElementById("reload_tab_id").addEventListener("click",(function(){chrome.storage.local.set({bug_data:null},(function(){console.log("Data has been removed.")})),t()})),document.getElementById("settings_tab_id").addEventListener("click",(function(){chrome.tabs.create({active:!0,url:"/function/settings/settings.html"},null)})),document.getElementById("review_tab_id").addEventListener("click",(function(){chrome.tabs.create({active:!0,url:"/function/bug/bug_list.html"},null)}))})();