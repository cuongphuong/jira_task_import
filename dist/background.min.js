(()=>{async function e(e,c,u){let l=[],_=[];if(""!==o(e.temp_result_issue_key)){let c=await fetch(`${u.common.jira_base_url}/rest/api/2/issue/${e.temp_result_issue_key}`,{method:"GET"}).then((e=>e.json())),d=!1;if(c.hasOwnProperty("errorMessages"))l.push("ERROR"),_.push("Issue key is not existed");else{let p=c.fields;if(!function(e,t,r){const n=r.bug.qc_activity,c=r.bug.priority,u=r.bug.defect_origin,l=r.bug.severity,_=r.bug.role,d=r.bug.defect_type,p=r.bug.cause_category,m=a(l,e.severity),g=a(_,e.role),f=a(d,e.defect_type),y=a(p,e.cause_category),h=a(u,e.defect_origin),b=a(c,e.priority),w=a(n,e.qc_activity);return o(e.description)===t.description&&o(h,r.bug.defect_origin_default)===s(t.customfield_11401,"id")&&o(b,r.bug.priority_default)===s(t.priority,"id")&&o(m,r.bug.severity_default)===s(t.customfield_10303,"id")&&o(w,r.bug.qc_activity_default)===s(t.customfield_10302,"id")&&o(e.cause_analysis,null)===t.customfield_10601&&o(e.corrective_action,null)===t.customfield_10603&&o(e.assigner,null)===s(t.assignee,"name")&&o(g,r.bug.role_default)===s(t.customfield_11405,"id")&&o(e.reporter,null)===s(t.reporter,"name")&&i(e.plan_start_date)===i(t.customfield_10203)&&o(e.original_estimate,null)===s(t.timetracking,"originalEstimate")&&o(e.remaining_estimate,null)===s(t.timetracking,"remainingEstimate")&&i(e.due_date)===i(t.duedate)&&o(f,r.bug.defect_type_default)===s(t.customfield_10301,"id")&&o(y,r.bug.cause_category_default)===s(t.customfield_10300,"id")}(e,p,u)){let t=r(u,e);t.length>0?(l.push("ERROR"),_=_.concat(t)):(d=!0,l.push("UPDATE_BASE_DATA"))}let m=t(e.temp_issue_status);if(m!==s(p.status,"name"))if("Open"===m||"Reopened"===m||"Cancelled"===m)l.push("CHANGE_STATUS"),d=!0;else{let t=n(u,e);t.length>0?(l.push("ERROR"),_=_.concat(t)):(l.push("CHANGE_STATUS"),d=!0)}}d||l.push("IGNORE")}else{let s=r(u,e),i=!1;s.length>0?(l.push("ERROR"),_=_.concat(s)):(l.push("NEW"),i=!0);let o=t(e.temp_issue_status);if("Cancelled"===o)l.push("CHANGE_STATUS"),i=!0;else if("Resolved"===o||"Closed"===o){let t=n(u,e);t.length>0?(l.push("ERROR"),_=_.concat(t)):(l.push("CHANGE_STATUS"),i=!0)}i||l.push("IGNORE")}return{rsl_status:l,rsl_msg:_}}function t(e){return e&&""!==e.trim()?"open"===e.toLowerCase()?"Open":"reopened"===e.toLowerCase()?"Reopened":"in progress"===e.toLowerCase()?"In Progress":"resolved"===e.toLowerCase()?"Resolved":"closed"===e.toLowerCase()?"Closed":"cancelled"===e.toLowerCase()?"Cancelled":"Open":"Open"}function s(e,t){return e&&e.hasOwnProperty(t)?e[t]:null}function i(e){let t=new Date(e);return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()}function r(e,t){let s=[];""===o(t.description)&&s.push("description is empty");let i=a(e.bug.qc_activity,t.qc_activity);const r=!e.bug.qc_activity_default;return""===o(i)&&r&&s.push("qc_activity is empty"),""===o(t.assigner)&&s.push("assigner is empty"),""===o(t.reporter)&&s.push("reporter is empty"),s}function n(e,t){let s=[];const i=a(e.bug.defect_type,t.defect_type),r=!e.bug.defect_type_default;""===o(i)&&r&&s.push("defect_type is empty");const n=a(e.bug.cause_category,t.cause_category),c=!e.bug.cause_category_default;return""===o(n)&&c&&s.push("cause_category is empty"),s}function o(e,t){return e&&""!==e.trim()?e:null===t?t:t||""}function a(e,t,s){return t?Object.keys(e).find((s=>e[s]===t)):""}chrome.runtime.onMessage.addListener((function(t,i,r){if("load"===t.req&&(chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];chrome.scripting.executeScript({target:{tabId:t.id,allFrames:!1},files:["static/js/read-excel-file.min.js","/function/bug/collect.min.js"]})})),r()),"close_this_tab"===t.req&&(chrome.tabs.remove(i.tab.id),r()),"notif"===t.req&&(chrome.notifications.create("",t.options),r()),"incorrect_user"===t.req&&(chrome.tabs.remove(i.tab.id),chrome.tabs.create({active:!0,url:"/function/settings/settings.html"},null),chrome.notifications.create("",{title:"Import",message:"User or password is incorrect!",iconUrl:"/img/error.png",type:"basic"}),r()),"process_data"===t.req)return(async()=>{const i=await async function(t){let i=await async function(){let e=await new Promise(((e,t)=>chrome.storage.local.get("settings",(function(t){e(t)})))),t=null;return e&&e.hasOwnProperty("settings")&&(t=e.settings),t}();if(!i)return;await async function(e){let t=e.common.jira_base_url,s=e.common.account.username,i=e.common.account.password;await fetch(`${t}/login.jsp?os_username=${s}&os_password=${i}`,{method:"POST"})}(i);let r=[];i.bug.temp_col_index;for(let n=0;n<t.length;n++){let o=t[n],a=await fetch(`${i.common.jira_base_url}/rest/api/2/issue/${o.temp_result_issue_key}`,{method:"GET"}).then((e=>e.json()));o.temp_id=s(a,"id");let c=await e(o,0,i);o.temp_checked_status=c,r.push(o)}return console.log(r),r}(t.data);r({payload:i})})(),!0}))})();